<!DOCTYPE html><html><head><title>kio-snake</title></head><body><script> (function(){var audioCtx,audioSrc,canvas,clearContext,context,direction,drawContext,fieldHeight,fieldWidth,food,gain,hit,keysound,moveSnack,ot,position,positionStack,removeContext,render,spawnFood,spawnSnack,speed,t;canvas=document.createElement("canvas");canvas.width="400";canvas.height="300";document.body.appendChild(canvas);audioCtx=new window.AudioContext;audioSrc=audioCtx.createOscillator();gain=audioCtx.createGain();audioSrc.type="square";audioSrc.frequency.value=440;gain.gain.value=0;audioSrc.connect(gain);gain.connect(audioCtx.destination);audioSrc.start();context=canvas.getContext("2d");speed=60;fieldWidth=40;fieldHeight=30;position=[0,0];direction=[1,0];positionStack=[];food=[0,0];spawnSnack=function(){position=[13,10];direction=[1,0];positionStack=[];positionStack.push([11,10]);positionStack.push([12,10]);positionStack.push([13,10]);drawContext(11,10,"#0A0");drawContext(12,10,"#0A0");drawContext(13,10,"#0A0")};spawnFood=function(){var x,y;audioSrc.type="square";audioSrc.frequency.value=800;gain.gain.value=.01;setTimeout(function(){return gain.gain.value=0},300);x=~~(Math.random()*40);y=~~(Math.random()*30);while(hit(x,y)){x=(x+1)%40;y=(y+1)%30}food=[x,y];drawContext(x,y,"#00A")};hit=function(x,y){var i,len,p,pos,res;res=false;p=[x,y];for(i=0,len=positionStack.length;i<len;i++){pos=positionStack[i];if(p[0]===pos[0]&&p[1]===pos[1]){res=true;break}}return res};moveSnack=function(){var last;audioSrc.type="square";audioSrc.frequency.value=100;gain.gain.value=.01;setTimeout(function(){return gain.gain.value=0},30);position[0]+=direction[0];if(0>position[0]){position[0]=39}if(fieldWidth<=position[0]){position[0]=0}position[1]+=direction[1];if(0>position[1]){position[1]=29}if(fieldHeight<=position[1]){position[1]=0}drawContext(position[0],position[1],"#0A0");console.log("x: "+position[0]+", y: "+position[1]+", l: "+positionStack.length);if(hit(position[0],position[1])){console.log("game over");clearContext();spawnSnack();spawnFood()}else{positionStack.push([position[0],position[1]]);if(food[0]===position[0]&&food[1]===position[1]){speed-=.1;spawnFood()}else{last=positionStack.shift();removeContext(last[0],last[1])}}};clearContext=function(){context.fillStyle="#000";context.fillRect(0,0,400,300);return context};drawContext=function(x,y,color){context.fillStyle=color;context.fillRect(x*10,y*10,10,10);return context};removeContext=function(x,y){context.fillStyle="#000";context.fillRect(x*10,y*10,10,10);return context};speed=60;ot=0;render=function(t){if(t-ot>speed){ot=t;moveSnack()}return window.requestAnimationFrame(render)};t=-1;keysound=function(){audioSrc.type="sawtooth";clearTimeout(t);audioSrc.frequency.value=1200;gain.gain.value=.01;return t=setTimeout(function(){return gain.gain.value=0},10)};document.body.onkeydown=function(e){switch(e.keyCode){case 38:if(direction[1]===0){direction=[0,-1];keysound()}break;case 39:if(direction[0]===0){direction=[1,0];keysound()}break;case 40:if(direction[1]===0){direction=[0,1];keysound()}break;case 37:if(direction[0]===0){direction=[-1,0];keysound()}}};clearContext();spawnSnack();spawnFood();render()}).call(this);</script></body></html>
